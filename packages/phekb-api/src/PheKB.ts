let staticList = [
  {
    nid: "1506",
    vid: "3586",
    type: "phenotype",
    language: "und",
    title: "Type 1 and type 2 Diabetes Mellitus",
    uid: "15149",
    status: "1",
    created: "1596674145",
    changed: "1596751985",
    comment: "2",
    promote: "0",
    sticky: "0",
    tnid: "0",
    translate: "0",
    uri: "https://dev-phekb.pantheonsite.io/api/node/1506",
  },
  {
    nid: "1454",
    vid: "3539",
    type: "phenotype",
    language: "und",
    title: "Familial Hypercholesterolemia (NLP)",
    uid: "14941",
    status: "1",
    created: "1586403252",
    changed: "1590253686",
    comment: "2",
    promote: "0",
    sticky: "0",
    tnid: "0",
    translate: "0",
    uri: "https://dev-phekb.pantheonsite.io/api/node/1454",
  },
  {
    nid: "1451",
    vid: "3502",
    type: "phenotype",
    language: "und",
    title: "COVID-19 Counts for eMERGE",
    uid: "15059",
    status: "1",
    created: "1585685239",
    changed: "1586453756",
    comment: "2",
    promote: "0",
    sticky: "0",
    tnid: "0",
    translate: "0",
    uri: "https://dev-phekb.pantheonsite.io/api/node/1451",
  },
  {
    nid: "1431",
    vid: "3463",
    type: "phenotype",
    language: "und",
    title: "Obsessive-compulsive disorder",
    uid: "14523",
    status: "1",
    created: "1583602776",
    changed: "1583602776",
    comment: "2",
    promote: "0",
    sticky: "0",
    tnid: "0",
    translate: "0",
    uri: "https://dev-phekb.pantheonsite.io/api/node/1431",
  },
  {
    nid: "1429",
    vid: "3457",
    type: "phenotype",
    language: "und",
    title: "elll ICD/CPT Files Refresh for eMERGESeq",
    uid: "14932",
    status: "1",
    created: "1582732961",
    changed: "1582737975",
    comment: "2",
    promote: "0",
    sticky: "0",
    tnid: "0",
    translate: "0",
    uri: "https://dev-phekb.pantheonsite.io/api/node/1429",
  },
  {
    nid: "1417",
    vid: "3512",
    type: "phenotype",
    language: "und",
    title: "ACO (Asthma COPD Overlap)",
    uid: "14464",
    status: "1",
    created: "1581435187",
    changed: "1587414815",
    comment: "2",
    promote: "0",
    sticky: "0",
    tnid: "0",
    translate: "0",
    uri: "https://dev-phekb.pantheonsite.io/api/node/1417",
  },
  {
    nid: "1404",
    vid: "3468",
    type: "phenotype",
    language: "und",
    title: "Urinary Incontinence",
    uid: "15022",
    status: "1",
    created: "1579148917",
    changed: "1583776371",
    comment: "2",
    promote: "0",
    sticky: "0",
    tnid: "0",
    translate: "0",
    uri: "https://dev-phekb.pantheonsite.io/api/node/1404",
  },
  {
    nid: "1394",
    vid: "3547",
    type: "phenotype",
    language: "und",
    title:
      "ECG Traits Extracted from Electrocardiograms using Natural Language Processing",
    uid: "15101",
    status: "1",
    created: "1576613506",
    changed: "1590768222",
    comment: "2",
    promote: "0",
    sticky: "0",
    tnid: "0",
    translate: "0",
    uri: "https://dev-phekb.pantheonsite.io/api/node/1394",
  },
  {
    nid: "1388",
    vid: "3376",
    type: "phenotype",
    language: "und",
    title: "GWAS ICD & Meds Files",
    uid: "14932",
    status: "1",
    created: "1575571091",
    changed: "1575571106",
    comment: "2",
    promote: "0",
    sticky: "0",
    tnid: "0",
    translate: "0",
    uri: "https://dev-phekb.pantheonsite.io/api/node/1388",
  },
  {
    nid: "1376",
    vid: "3361",
    type: "phenotype",
    language: "und",
    title: "Pascal Test",
    uid: "14954",
    status: "1",
    created: "1574206167",
    changed: "1574206167",
    comment: "2",
    promote: "0",
    sticky: "0",
    tnid: "0",
    translate: "0",
    uri: "https://dev-phekb.pantheonsite.io/api/node/1376",
  },
  {
    nid: "1295",
    vid: "3230",
    type: "phenotype",
    language: "und",
    title: "elll BMI file re-uploads for dbGaP submission",
    uid: "14932",
    status: "1",
    created: "1565721216",
    changed: "1566999496",
    comment: "2",
    promote: "0",
    sticky: "0",
    tnid: "0",
    translate: "0",
    uri: "https://dev-phekb.pantheonsite.io/api/node/1295",
  },
  {
    nid: "1252",
    vid: "3172",
    type: "phenotype",
    language: "und",
    title: "eMERGE Phenotyping III case/control files collection",
    uid: "14932",
    status: "1",
    created: "1561554121",
    changed: "1561988992",
    comment: "2",
    promote: "0",
    sticky: "0",
    tnid: "0",
    translate: "0",
    uri: "https://dev-phekb.pantheonsite.io/api/node/1252",
  },
  {
    nid: "1205",
    vid: "3310",
    type: "phenotype",
    language: "und",
    title: "Digital Rectal Exam",
    uid: "14731",
    status: "1",
    created: "1557773569",
    changed: "1570722034",
    comment: "2",
    promote: "0",
    sticky: "0",
    tnid: "0",
    translate: "0",
    uri: "https://dev-phekb.pantheonsite.io/api/node/1205",
  },
  {
    nid: "1197",
    vid: "3079",
    type: "phenotype",
    language: "und",
    title: "bone scan utilization ",
    uid: "14731",
    status: "1",
    created: "1556237435",
    changed: "1556237598",
    comment: "2",
    promote: "0",
    sticky: "0",
    tnid: "0",
    translate: "0",
    uri: "https://dev-phekb.pantheonsite.io/api/node/1197",
  },
  {
    nid: "1196",
    vid: "3077",
    type: "phenotype",
    language: "und",
    title: "bone scan utilization ",
    uid: "14731",
    status: "1",
    created: "1556237268",
    changed: "1556237268",
    comment: "2",
    promote: "0",
    sticky: "0",
    tnid: "0",
    translate: "0",
    uri: "https://dev-phekb.pantheonsite.io/api/node/1196",
  },
  {
    nid: "1175",
    vid: "3225",
    type: "phenotype",
    language: "und",
    title: "Chronic Obstructive Lung Disease (COPD)",
    uid: "14464",
    status: "1",
    created: "1549485381",
    changed: "1566334997",
    comment: "2",
    promote: "0",
    sticky: "0",
    tnid: "0",
    translate: "0",
    uri: "https://dev-phekb.pantheonsite.io/api/node/1175",
  },
  {
    nid: "1149",
    vid: "3005",
    type: "phenotype",
    language: "und",
    title: "eMERGE III Record Counter, Y4U2, Winter 2019",
    uid: "14279",
    status: "1",
    created: "1547223552",
    changed: "1547230514",
    comment: "2",
    promote: "0",
    sticky: "0",
    tnid: "0",
    translate: "0",
    uri: "https://dev-phekb.pantheonsite.io/api/node/1149",
  },
  {
    nid: "1130",
    vid: "3474",
    type: "phenotype",
    language: "und",
    title: "Atopic Dermatitis Algorithm with NLP and ML",
    uid: "49",
    status: "1",
    created: "1542416063",
    changed: "1584479652",
    comment: "2",
    promote: "0",
    sticky: "0",
    tnid: "0",
    translate: "0",
    uri: "https://dev-phekb.pantheonsite.io/api/node/1130",
  },
  {
    nid: "1105",
    vid: "3332",
    type: "phenotype",
    language: "und",
    title: "Anxiety algorithm",
    uid: "4077",
    status: "1",
    created: "1540386714",
    changed: "1572618770",
    comment: "2",
    promote: "0",
    sticky: "0",
    tnid: "0",
    translate: "0",
    uri: "https://dev-phekb.pantheonsite.io/api/node/1105",
  },
  {
    nid: "1100",
    vid: "2921",
    type: "phenotype",
    language: "und",
    title:
      "eMERGE I, II, III Merged Imputed GWAS Dataset: Subject Consent for dbGaP",
    uid: "14279",
    status: "1",
    created: "1539006260",
    changed: "1539782744",
    comment: "2",
    promote: "0",
    sticky: "0",
    tnid: "0",
    translate: "0",
    uri: "https://dev-phekb.pantheonsite.io/api/node/1100",
  },
];

class PheKB {
  baseUrl: string;

  constructor(baseUrl: string) {
    this.baseUrl = baseUrl;
  }

  sortByName(phenotypes) {
    return phenotypes.sort((a, b) =>
      a.title.toUpperCase() < b.title.toUpperCase() ? -1 : 1
    );
  }

  async getPhenotypes(maxPages) {
    // Use the following for testing so we don't keep hitting the server
    // return Promise.resolve(this.sortByName(staticList));

    const phenotypes = [];

    const pageLimit = maxPages || 1000;

    let page = 0;

    let results;
    do {
      results = await fetch(
        `${this.baseUrl}/node?parameters[type]=phenotype&page=${page}`
      ).then((res) => res.json());

      if (results.length > 0) {
        phenotypes.push(...results);
        page++;
      }
    } while (results.length > 0 && page < pageLimit);

    return this.sortByName(phenotypes);
  }
}

export default PheKB;
